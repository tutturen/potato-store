sudo: required
services:
  - docker
language: python
python: "3.6"
install:
  - pip install pipenv
  - cd src && pipenv install
script:
  - cd src && pipenv run manage.py test
  - docker build -t registry.heroku.com/$HEROKU_APP/web -f Dockerfile.production .

deploy:
  provider: script
  script: bash docker_push
  on:
    branch: master

